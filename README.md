# qubership-virtual-secretary

### Local Development
To connect to DB using DBeaver use following tips:
1. Select H2 Embedded type of the data-base
2. Go to "Driver settings" -> "Libraries"
   2.1 Remove existed driver (if exists)
   2.2 Click "Add artifact"
   2.3 Paste maven declaration for H2 into "Dependecy Declaration", i.e.
```xml
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <version>2.2.224</version>
</dependency>
```
   2.4 Apply settings
3. URL = jdbc:h2:{PATH_TO_DB_FILE};CIPER=AES
4. Username
5. Password field constists of two passwords: FILE_PASSWORD + ONE SPACE + USER_PASSWORD
6. Test Connection
7. Finish

### Setup
#### all-qs-members.json
List of team members to be notified is managed via "ALL_QS_MEMBERS" secret.
It must contain json structure, like:
```json
{
  "qubership-members" : [ {
    "email" : "user1@example.com",
    "full-name" : "FirstName1 LastName1",
    "lead-full-name" : "LeadFirstName1 LeadLastName1",
    "lead-email" : "lead1@example.com"
  }, {
    "email" : "user2@example.com",
    "full-name" : "FirstName2 LastName2",
    "lead-full-name" : "LeadFirstName2 LeadLastName2",
    "lead-email" : "lead2@example.com"
  },
  ...
}
```

During run - the content of this secret will be mounted into local temp-file, which is mentioned in the app.properties.
See details in the ./.github/workflow/main.yml" action file.

#### app.properies
```properties
version=1
MATTERMOST_HOSTNAME=mattermost.example.com
MATTERMOST_TOKEN=mattermost_secret_token
WEEKLY_REPORT_SHEET_ID=googe_sheet_id
WEEKLY_REPORT_SHEET_NAME=Sheet1
WEEKLY_REPORT_API_KEY=google_sheets_api_key
WEEKLY_REPORT_START_DATE_MONDAY=YYYY-MM-DD
QUBERSHIP_TEAM_CONFIG_FILE=./all_qs_members.json
DB_USER_NAME=db_user_name
DB_USER_PASSWORD=db_user_password
DB_FILE_ENCRYPTION_PASSWORD=pass_to_encrypt_file_with_database
DEEP-SEEK-URL=https://api.deepseek.com/chat/completions
DEEP-SEEK-TOKEN=sk-deepseek-token
WEEKLY_REPORT_GOOGLE_FORM_URL=https://forms.gle/qwerty123
```

Properties description

| PROPERTY                        | DESCRIPTION                                                                                                                                                                                                                                                  |
|---------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| version                         | Just informational property which may be printed in the logs for trouble-shooting aims                                                                                                                                                                       |
| MATTERMOST_HOSTNAME             | Mattermost instance domain to connect Virtual Secretary to for notification purposes                                                                                                                                                                         |
| MATTERMOST_TOKEN                | The mattermost bot token which will be used by Virtual Secretary                                                                                                                                                                                             |
| WEEKLY_REPORT_SHEET_ID          | All results from the Google Forms Questionarry must be collected in to table form of Google Tables (see format below). The Virtual Secretary will fetch user reports from the Google Sheet Forms                                                             |
| WEEKLY_REPORT_SHEET_NAME        | Google Sheets Sheet name to read data from                                                                                                                                                                                                                   |
| WEEKLY_REPORT_API_KEY           | Token to be generated by Google Sheet API to allow access to Google Sheets                                                                                                                                                                                   |
| WEEKLY_REPORT_START_DATE_MONDAY | Start date to process users reports from. All other will be ignored. Usefull when too much reports exist                                                                                                                                                     |
| QUBERSHIP_TEAM_CONFIG_FILE      | Reference to JSON-based file with list of team members to process. The Mattermost instance may contain lot of users, but no all must be processed/covered by Virtual Secretary. So, identification by email will be used                                     |
| DB_USER_NAME                    | All data (statistics) between runs will be stored in the local data-base using HSQLDB. The name of DB is required. Can be any simple string.                                                                                                                 |
| DB_USER_PASSWORD                | Password for the database                                                                                                                                                                                                                                    |
| DB_FILE_ENCRYPTION_PASSWORD     | The database file is stored right in the repository. It is checkouted/commited back during the run. If you are aware of security - you need to encrypt it additionally on the file-system layer. So set the password for the encryption of the database file |
| DEEP-SEEK-URL                   | OpenAI-compatible host to use GenAI for reports analysys.                                                                                                                                                                                                    |
| DEEP-SEEK-TOKEN                 | Token to authenticate with in GenAI                                                                                                                                                                                                                          |
| WEEKLY_REPORT_GOOGLE_FORM_URL   | All answers of the team must be collected into Google sheet in a special format, see details of the sheet below                                                                                                                                              |

Google sheet format, the reply comes in JSON with following fields:

| Field          | Description                                                                                                                                                         |
|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| timestamp      | Timestamp of the answer in the format dd.MM.yyyy HH:mm:ss, it should be automatically produced field when Google Forms export data into Google Sheets               |
| blueStreamLead | Some identifier (enumeration) to understand which departmet the reporter belongs to. Currenly is an optional field, later is desired to be used for summary reports |
| weekStartDate  | The date (in format dd.MM.yyyy) to identify the week the report is created for.                                                                                     | 
| completedWork  | Text field - the report itself, to be analyzed with GenAI                                                                                                           |
| nextWeekPlans  | Text field - currently an optional field                                                                                                                            |
| email          | email to identify reporter. It is recommended to enable authentication in the Google Forms                                                                          |

Summary Results

Currently summary results are rendering in the logs of GitHub action only (using MD-format)
